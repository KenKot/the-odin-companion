const flashcardSchema = new mongoose.Schema({
  question: String,
  answer: String,
  isMastered: { type: Boolean, default: false },
});

const lessonSchema = new mongoose.Schema({
  title: String,
  flashcards: [flashcardSchema],
});

const courseSchema = new mongoose.Schema({
  title: String,
  lessons: [{ type: mongoose.Schema.Types.ObjectId, ref: "Lesson" }],
});

const userSchema = new mongoose.Schema({
  name: String,
  email: String,
  courses: [{ type: mongoose.Schema.Types.ObjectId, ref: "Course" }],
});
//

lessonSchema.methods.getMasteredCount = function () {
  let masteredCount = 0;
  this.flashcards.forEach((flashcard) => {
    if (flashcard.isMastered) {
      masteredCount++;
    }
  });
  return masteredCount;
};

courseSchema.methods.getCompletedLessonsCount = async function () {
  const Lesson = mongoose.model("Lesson");
  let completedLessonsCount = 0;

  for (let lessonId of this.lessons) {
    const lesson = await Lesson.findById(lessonId);
    if (lesson.getMasteredCount() === lesson.flashcards.length) {
      completedLessonsCount++;
    }
  }

  return completedLessonsCount;
};

// const mongoose = require("mongoose");
// const { Schema } = mongoose;

// const FlashcardSchema = new Schema({
//   question: String,
//   answer: String,
//   status: Number,
// });

// const LessonSchema = new Schema({
//   title: String,
//   flashcards: [{ type: Schema.Types.ObjectId, ref: "Flashcard" }],
//   numFlashcards0: Number,
//   numFlashcards1: Number,
//   numFlashcards2: Number,
// });

// const CourseSchema = new Schema({
//   name: String,
//   completed: Boolean,
//   lessons: [{ type: Schema.Types.ObjectId, ref: "Lesson" }],
// });

// const UserSchema = new Schema({
//   username: String,
//   email: String,
//   courses: [{ type: Schema.Types.ObjectId, ref: "Course" }],
// });

// const User = mongoose.model("User", UserSchema);
// const Course = mongoose.model("Course", CourseSchema);
// const Lesson = mongoose.model("Lesson", LessonSchema);
// const Flashcard = mongoose.model("Flashcard", FlashcardSchema);

// module.exports = { User, Course, Lesson, Flashcard };
